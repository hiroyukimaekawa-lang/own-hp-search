<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ†ãƒ¬ã‚¢ãƒå–¶æ¥­å¯¾è±¡ãƒªã‚¹ãƒˆä½œæˆãƒ„ãƒ¼ãƒ«ï¼ˆç„¡æ–™ç‰ˆï¼‰</title>
    <link rel="stylesheet" href="/static_free/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ¨ ãƒ†ãƒ¬ã‚¢ãƒå–¶æ¥­å¯¾è±¡ãƒªã‚¹ãƒˆä½œæˆãƒ„ãƒ¼ãƒ«ï¼ˆç„¡æ–™ç‰ˆï¼‰</h1>
            <p class="subtitle">æ–½è¨­åãƒªã‚¹ãƒˆã‹ã‚‰å–¶æ¥­å¯¾è±¡ã‚’è‡ªå‹•åˆ¤å®šï¼ˆAPIä¸ä½¿ç”¨ãƒ»å®Œå…¨ç„¡æ–™ï¼‰</p>
        </header>

        <main>
            <div class="upload-section">
                <h2>ğŸ“¤ CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</h2>
                <form id="uploadForm" enctype="multipart/form-data">
                    <div class="form-group">
                        <label for="file">CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</label>
                        <input type="file" id="file" name="file" accept=".csv" required>
                        <small>â€» Aåˆ—ã«æ–½è¨­åï¼ˆå±‹å·ï¼‰ãŒå«ã¾ã‚Œã¦ã„ã‚‹CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„</small>
                    </div>

                    <button type="submit" id="submitBtn" class="btn btn-primary">
                        <span id="submitText">å‡¦ç†ã‚’é–‹å§‹</span>
                        <span id="loadingSpinner" class="spinner" style="display: none;"></span>
                    </button>
                </form>
            </div>

            <div id="errorMessage" class="error-message" style="display: none;"></div>
            <div id="successMessage" class="success-message" style="display: none;"></div>

            <div id="progressSection" class="progress-section" style="display: none;">
                <h3>å‡¦ç†çŠ¶æ³</h3>
                <div class="progress-bar">
                    <div id="progressBar" class="progress-bar-fill"></div>
                </div>
                <p id="progressText" class="progress-text">å‡¦ç†ä¸­...</p>
            </div>

            <div id="resultSection" class="result-section" style="display: none;">
                <h2>ğŸ“Š å‡¦ç†çµæœ</h2>
                <div id="summary" class="summary"></div>
                <button id="downloadBtn" class="btn btn-success">çµæœã‚’CSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
            </div>

            <div class="info-section">
                <h2>ğŸ“‹ ä½¿ã„æ–¹</h2>
                <ol>
                    <li>æ–½è¨­åï¼ˆå±‹å·ï¼‰ãŒAåˆ—ã«è¨˜è¼‰ã•ã‚ŒãŸCSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’æº–å‚™ã—ã¦ãã ã•ã„</li>
                    <li>CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ã€Œå‡¦ç†ã‚’é–‹å§‹ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
                    <li>å‡¦ç†å®Œäº†å¾Œã€ã€Œçµæœã‚’CSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€ãƒœã‚¿ãƒ³ã§çµæœã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</li>
                </ol>

                <h3>å…¥åŠ›CSVå½¢å¼</h3>
                <table class="example-table">
                    <thead>
                        <tr>
                            <th>Aåˆ—: æ–½è¨­å</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>æ°‘å®¿ ã‚„ã—ã‚</td></tr>
                        <tr><td>ãƒšãƒ³ã‚·ãƒ§ãƒ³ ã‚·ãƒ¼ã‚¬ãƒ«</td></tr>
                        <tr><td>ãƒªã‚¾ãƒ¼ãƒˆãƒ›ãƒ†ãƒ« ABC</td></tr>
                    </tbody>
                </table>

                <h3>å‡ºåŠ›CSVå½¢å¼</h3>
                <table class="example-table">
                    <thead>
                        <tr>
                            <th>Aåˆ—: æ–½è¨­å</th>
                            <th>Båˆ—: HP URL</th>
                            <th>Cåˆ—: å–¶æ¥­å¯¾è±¡</th>
                            <th>Dåˆ—: éƒ½é“åºœçœŒ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>æ°‘å®¿ ã‚„ã—ã‚</td>
                            <td></td>
                            <td>ã¯ã„</td>
                            <td>æ±äº¬éƒ½</td>
                        </tr>
                        <tr>
                            <td>ãƒšãƒ³ã‚·ãƒ§ãƒ³ ã‚·ãƒ¼ã‚¬ãƒ«</td>
                            <td>https://example.wixsite.com</td>
                            <td>ã¯ã„</td>
                            <td>ç¥å¥ˆå·çœŒ</td>
                        </tr>
                        <tr>
                            <td>ãƒªã‚¾ãƒ¼ãƒˆãƒ›ãƒ†ãƒ« ABC</td>
                            <td>https://example.com</td>
                            <td>ã„ã„ãˆ</td>
                            <td>æ²–ç¸„çœŒ</td>
                        </tr>
                    </tbody>
                </table>

                <h3>å–¶æ¥­å¯¾è±¡ã®åˆ¤å®šæ¡ä»¶</h3>
                <ul>
                    <li>å…¬å¼HPãŒå­˜åœ¨ã—ãªã„ã€ã¾ãŸã¯ç°¡æ˜“HPã‚µãƒ¼ãƒ“ã‚¹ï¼ˆWordPress/Wix/Canva/ãƒšãƒ©ã‚¤ãƒ/Jimdoï¼‰ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹</li>
                    <li>éƒ½é“åºœçœŒãŒæ²–ç¸„çœŒã§ã¯ãªã„</li>
                </ul>

                <h3>åˆ¤å®šæ–¹æ³•</h3>
                <ol>
                    <li>æ–½è¨­å + " Google ãƒãƒƒãƒ—" ã§Googleæ¤œç´¢</li>
                    <li>Googleãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã®ãƒšãƒ¼ã‚¸URLã‚’å–å¾—</li>
                    <li>ãƒšãƒ¼ã‚¸HTMLã‚’å–å¾—ã—ä»¥ä¸‹ã‚’æŠ½å‡ºï¼š
                        <ul>
                            <li>ã€Œã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã€ãƒªãƒ³ã‚¯</li>
                            <li>ä½æ‰€</li>
                        </ul>
                    </li>
                    <li>HPãŒå­˜åœ¨ã—ãªã„å ´åˆ â†’ å–¶æ¥­å¯¾è±¡ã€Œã¯ã„ã€</li>
                    <li>HPãŒå­˜åœ¨ã™ã‚‹å ´åˆã€ç°¡æ˜“HPã‚µãƒ¼ãƒ“ã‚¹ã‹ã©ã†ã‹ã‚’åˆ¤å®š</li>
                    <li>ä½æ‰€ã«ã€Œæ²–ç¸„çœŒã€ãŒå«ã¾ã‚Œã‚‹å ´åˆã¯ç„¡æ¡ä»¶ã§ã€Œã„ã„ãˆã€</li>
                </ol>

                <div class="note-box">
                    <h4>âš ï¸ æ³¨æ„äº‹é …</h4>
                    <ul>
                        <li>ã“ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯å®Œå…¨ç„¡æ–™ã§ã€æœ‰æ–™APIã¯ä½¿ç”¨ã—ã¾ã›ã‚“</li>
                        <li>Googleæ¤œç´¢ã¨HTMLã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã€å‡¦ç†ã«æ™‚é–“ãŒã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™</li>
                        <li>Googleæ¤œç´¢ã®çµæœã«ä¾å­˜ã™ã‚‹ãŸã‚ã€æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯æƒ…å ±ãŒå–å¾—ã§ããªã„å ´åˆãŒã‚ã‚Šã¾ã™</li>
                        <li>å¤§é‡ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‡¦ç†ã™ã‚‹å ´åˆã¯ã€æ™‚é–“ãŒã‹ã‹ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™</li>
                    </ul>
                </div>
            </div>
        </main>
    </div>

    <script>
        const form = document.getElementById('uploadForm');
        const submitBtn = document.getElementById('submitBtn');
        const submitText = document.getElementById('submitText');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const errorMessage = document.getElementById('errorMessage');
        const successMessage = document.getElementById('successMessage');
        const progressSection = document.getElementById('progressSection');
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        const resultSection = document.getElementById('resultSection');
        const summary = document.getElementById('summary');
        const downloadBtn = document.getElementById('downloadBtn');

        let csvData = null;

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const fileInput = document.getElementById('file');
            
            if (!fileInput.files[0]) {
                showError('ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            const formData = new FormData();
            formData.append('file', fileInput.files[0]);

            // UIæ›´æ–°
            submitBtn.disabled = true;
            submitText.textContent = 'å‡¦ç†ä¸­...';
            loadingSpinner.style.display = 'inline-block';
            errorMessage.style.display = 'none';
            successMessage.style.display = 'none';
            resultSection.style.display = 'none';
            progressSection.style.display = 'block';
            progressBar.style.width = '0%';
            progressText.textContent = 'å‡¦ç†ã‚’é–‹å§‹ã—ã¦ã„ã¾ã™...';

            try {
                const response = await fetch('/api/process', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || 'å‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }

                // CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                const blob = await response.blob();
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'å–¶æ¥­å¯¾è±¡ãƒªã‚¹ãƒˆ.csv';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);

                // é€²æ—æ›´æ–°
                progressBar.style.width = '100%';
                progressText.textContent = 'å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸï¼';

                successMessage.textContent = 'å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸï¼CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸã€‚';
                successMessage.style.display = 'block';

            } catch (error) {
                showError(error.message);
            } finally {
                submitBtn.disabled = false;
                submitText.textContent = 'å‡¦ç†ã‚’é–‹å§‹';
                loadingSpinner.style.display = 'none';
            }
        });

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
        }
    </script>
</body>
</html>

