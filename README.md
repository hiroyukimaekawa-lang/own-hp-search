# テレアポ営業用施設判定アプリケーション（SerpAPI版）

CSVで渡された施設名リストから、公式HPの有無・簡易HPかどうか・対象都道府県かを自動判定し、営業対象リストを作成するWebアプリケーションです。

## 📋 機能

- CSVファイルから施設名リストを読み込み
- SerpAPIを使用してGoogle検索結果から各施設の情報を自動検索
- 公式HPの有無を自動判定
- 簡易HPサービス（Wix/WordPress/Canva/ペライチ等）の判定
- 都道府県の自動抽出
- 営業対象の自動判定（沖縄県・離島を除外）
- 結果をCSVファイルでダウンロード

## 🚀 セットアップ

### 1. 依存パッケージのインストール

```bash
pip install -r requirements.txt
```

### 2. SerpAPIキーの取得

1. [SerpAPI公式サイト](https://serpapi.com/)にアクセス
2. 無料アカウントを作成
3. APIキーを取得（無料プラン: 月100回まで利用可能）

### 3. アプリケーションの起動

```bash
python main_serpapi.py
```

または

```bash
uvicorn main_serpapi:app --reload --port 8000
```

ブラウザで `http://localhost:8000` にアクセスしてください。

## 📖 使い方

### 入力CSVファイル形式

- **A列（1列目）: 施設名（屋号）** - 必須

**入力CSV例:**
```csv
施設名
民宿 やしろ
ペンション シーガル
リゾートホテル ABC
```

### 出力CSVファイル形式

- **A列: 施設名** - 元データ
- **B列: 公式HPのURL** - 存在しない場合は空欄
- **C列: 営業対象か** - 「はい」または「いいえ」
- **D列: 都道府県名** - 抽出された都道府県名

**出力CSV例:**
```csv
施設名,公式HPのURL,営業対象か,都道府県名
民宿 やしろ,,はい,東京都
ペンション シーガル,https://example.com,いいえ,神奈川県
リゾートホテル ABC,https://wixsite.com/example,はい,静岡県
```

## 🎯 営業対象の定義

以下すべてを満たす場合「はい」と判定されます：

1. **公式HPが存在しない** OR **簡易HPサービスを使用している**
   - WordPress
   - Wix
   - Canva
   - ペライチ
   - Jimdo
   - その他の簡易HPサービス

2. **都道府県が沖縄県ではない**

3. **離島ではない**（沖縄県の離島含む）

## 🔍 判定ロジック

1. **施設名でSerpAPI検索**
   - Google検索結果から施設情報を取得

2. **以下の情報を取得**
   - `website`（公式HP URL）
   - `address`（住所）

3. **住所から都道府県を抽出**
   - 正規表現を使用して都道府県名を抽出

4. **ウェブサイト判定**
   - URLドメインを解析
   - HTMLのmeta情報を解析（必要に応じて）

5. **離島判定**
   - 住所に離島キーワードが含まれているかチェック

6. **営業対象判定**
   - 上記の条件をすべてチェックして判定

## ⚙️ 技術スタック

- **Python 3.8+**
- **FastAPI** - Webフレームワーク
- **SerpAPI** - Google検索結果取得
- **requests** - HTTPリクエスト
- **BeautifulSoup** - HTMLパース
- **python-dotenv** - 環境変数管理

## 📝 簡易モード

HP判定が難しい場合は、「Googleビジネスプロフィール上にwebサイトが登録されていない施設のみ抽出」という簡易モードも利用できます。

- チェックボックスで簡易モードを選択可能
- 簡易モードでは、websiteが空の施設のみを「はい」と判定

## ⚠️ 注意事項

- SerpAPIには利用制限があります（無料プラン: 月100回）
- API呼び出しの間隔を1秒空けています
- 離島の判定は住所のキーワードベースで行っています。完全ではない場合があります
- 簡易HPの判定は、ドメインとHTMLのmeta情報を基に行っています

## 📁 ファイル構成

```
.
├── main_serpapi.py        # FastAPIアプリケーション
├── requirements.txt       # 依存パッケージ一覧
├── templates/             # HTMLテンプレート
│   └── index.html
├── static/                # 静的ファイル（CSS等）
│   └── style.css
├── facilities.xlsx        # サンプル施設データ
├── README.md              # このファイル
└── スクリーンショット*.png # スクリーンショット
```

## 🔧 開発

### ローカル開発環境の起動

```bash
uvicorn main_serpapi:app --reload --host 0.0.0.0 --port 8000
```

### 本番環境へのデプロイ

```bash
uvicorn main_serpapi:app --host 0.0.0.0 --port 8000
```

## 📄 ライセンス

このプロジェクトは内部使用を目的としています。
